\chapter{Исследовательский раздел}

В данном разделе будет поставлен эксперимент по оценки эффективности работы алгоритма с использованием параллельности.

\section{Цель эксперимента}
 
Рассматривая схему алгоритма Dual Marching Cubes \ref{img:rpz_drawings-schema_dualmc}-\ref{img:rpz_drawings-enumerateTriangles_3}, можно заметить, что построение отдельных восьмеричных деревьев, как и нахождение треугольников изоповерхности не зависит от их соседей. Таким образом, возможно распараллеливание вложенных циклов на рисунках \ref{img:rpz_drawings-schema_generateForest} и \ref{img:rpz_drawings-enumerateTriangles_1}.

Целью эксперимента является оценка временной эффективности параллельной реализации алгоритма Dual Marching Cubes.

\section{Описание эксперимента}

С помощью библиотеки \texttt{OpenMP}\cite{openmp} было реализовано параллельное выполнение циклов на рисунках \ref{img:rpz_drawings-schema_generateForest} и \ref{img:rpz_drawings-enumerateTriangles_1}.

На 1 этапе алгоритма создаётся много узлов восьмеричного дерева, что вызывает блокировки потоков вовремя выделения памяти. Чтобы их обойти был создан специальный класс \texttt{ObjectPool}, который выделяет память заранее и при необходимости удваивает ее.

Эксперимент проводился на компьютере со следующими характеристиками.
\begin{itemize}
	\item Операционная система: Windows;
	\item Память: 16 GiB;
	\item Процессор: Intel i5-10210U CPU @ 1.60GHz;
	\item Количество логических потоков: 8.
\end{itemize}

В таблице \ref{tab:results} представлены результаты эксперимента: усредненное за 40 прогонов время полигонизации томографии мишки в зависимости от размеров сетки и максимальной глубины восьмеричных деревьев. 

\begin{table}[]
    \centering
    \caption{Среднее время полигонизации параллельной и последовательной реализации алгоритма.}
    \label{tab:results}
    \begin{tabular}{|c|c|c|c|}
        \hline
        \bfseries Макс. глубина & \bfseries Размер сетки, & \multicolumn{2}{c|}{\bfseries Время, мс} \\ \cline{3-4}
        \bfseries деревьев, ед. & \bfseries ячеек & \bfseries Послед. реал. & \bfseries Паралл. реал. 
        \csvreader[no head]{inc/csv/time.csv}{}
		{\\\hline \csvcoli&\csvcolii&\csvcoliii&\csvcoliv}
        \\\hline
    \end{tabular}
\end{table}

\clearpage

\section*{Вывод}
\addcontentsline{toc}{section}{Вывод}

В данном разделе был проведен эксперимент по параллелизации алгоритма Dual Marching Cubes. 

В результате эксперимента были получены следующие результаты:
\begin{itemize}
    \item последовательная реализация алгоритма имеет меньшее время для любой максимальной глубины деревьев только при размере сетки в 1 ячейку (при макс. глубине 3 последовательная реализация быстрее на 23\%). Это связано с потерями на создание отдельных потоков, инициализацию и использования дополнительных структур;
    \item параллельная реализация быстрее последовательной при размерах сетки, больших 1 ячейки. Так при макс. глубине деревьев 1 и размере сетки в 5 ячеек параллельная реализация быстрее в 3.78 раз, а при макс. глубине 2 и размере сетки в 20 ячеек -- быстрее в 2.75 раз;
    \item с увеличением максимальной глубины деревьев эффективность параллелизации падает, что согласовывается с законом Амдала: вместе с увеличением максимальной глубины восьмеричного дерева, увеличивается и время построения самого глубокого дерева, то есть увеличивается время самого медленного последовательного фрагмента задачи. При размере сетки в 10 ячеек и макс. глубине 1 параллельная реализация быстрее в 4.07 раз, при макс. глубине 2 -- в 2.78 раз, а при глубине 3 -- в 2.73 раза.
\end{itemize}